---
import Layout from "../layouts/Layout.astro";

// Static mock data for fallback/initial render
const programmers = {
    "alex-panther": {
        name: "Alex 'Panther' Code",
        role: "Full Stack Developer",
        image: "https://images.unsplash.com/photo-1573164713714-d95e436ab8d6?q=80&w=1000&auto=format&fit=crop",
        bio: "Especialista en arquitecturas escalables y rendimiento extremo. Mezclo React con la robustez de Node.js para crear experiencias inquebrantables.",
        skills: ["React", "Node.js", "MongoDB", "TypeScript", "AWS"],
    },
    "sarah-viper": {
        name: "Sarah 'Viper' Script",
        role: "Frontend Specialist",
        image: "https://images.unsplash.com/photo-1580489944761-15a19d654956?q=80&w=1000&auto=format&fit=crop",
        bio: "Maestra de la interfaz. Tejo código visual con Vue y Three.js para que el usuario no solo visite una web, sino que viva en ella.",
        skills: ["Vue", "Three.js", "CSS", "WebGL", "Figma"],
    },
    "david-bear": {
        name: "David 'Bear' Data",
        role: "Backend Architect",
        image: "https://images.unsplash.com/photo-1542909168-82c3e7fdca5c?q=80&w=1000&auto=format&fit=crop",
        bio: "Domador de datos masivos. Diseño bases de datos que duermen en contenedores Docker y despiertan con la velocidad de un rayo.",
        skills: ["Python", "Docker", "PostgreSQL", "Redis", "Kubernetes"],
    },
} as any;
---

<Layout title="Perfil de Operador | CiberPortfolio">
    <div id="profile-container" class="profile-container">
        <!-- Header Section -->
        <div class="profile-header">
            <div class="profile-image-container">
                <img id="p-image" src="" alt="Profile" />
            </div>
            <div class="profile-info">
                <h1 id="p-name" class="glitch" data-text=""></h1>
                <h3 id="p-role"></h3>
                <p id="p-bio"></p>
                <div id="p-skills" class="skills-list">
                    <!-- Skills injected -->
                </div>
            </div>
        </div>

        <!-- Projects Grid -->
        <div class="projects-section">
            <h2 class="section-title">
                PROYECTOS <span class="neon-text">DESPLEGADOS</span>
            </h2>
            <div id="projects-grid" class="projects-grid">
                <!-- Projects injected here -->
            </div>
        </div>
    </div>
</Layout>

<script define:vars={{ programmers }}>
    // Get ID from URL
    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get("id");

    const container = document.getElementById("profile-container");
    const pName = document.getElementById("p-name");
    const pRole = document.getElementById("p-role");
    const pBio = document.getElementById("p-bio");
    const pImage = document.getElementById("p-image");
    const pSkills = document.getElementById("p-skills");
    const projectsGrid = document.getElementById("projects-grid");

    if (id && programmers[id]) {
        const prog = programmers[id];

        // Initial Render from Static Data
        if (pName) {
            pName.textContent = prog.name;
            pName.setAttribute("data-text", prog.name);
        }
        if (pRole) pRole.textContent = prog.role;
        if (pBio) pBio.textContent = prog.bio;
        if (pImage) pImage.setAttribute("src", prog.image);
        if (pSkills) {
            pSkills.innerHTML = prog.skills
                .map((s) => `<span class="skill-tag">${s}</span>`)
                .join("");
        }

        // Load Projects from LocalStorage
        const allProjects = JSON.parse(
            localStorage.getItem("ciber_projects") || "[]",
        );
        const userProjects = allProjects.filter((p) => p.ownerId === id);

        if (projectsGrid) {
            if (userProjects.length > 0) {
                projectsGrid.innerHTML = userProjects
                    .map(
                        (p) => `
                    <div class="project-card">
                        <div class="project-img" style="background-image: url('${p.imageUrl || "https://images.unsplash.com/photo-1550751827-4bd374c3f58b"}')"></div>
                        <div class="project-content">
                            <div class="project-top">
                                <h3>${p.name}</h3>
                                <span class="type-badge ${p.type === "Profesional" ? "pro" : "acad"}">${p.type}</span>
                            </div>
                            <p>${p.description}</p>
                            <div class="tech-stack">
                                ${p.techs.map((t) => `<span>${t}</span>`).join("")}
                            </div>
                            <div class="project-links">
                                <a href="${p.repoUrl}" target="_blank" class="cyber-btn small">CODE</a>
                                <a href="${p.deployUrl}" target="_blank" class="cyber-btn small fill">DEMO</a>
                            </div>
                        </div>
                    </div>
                `,
                    )
                    .join("");
            } else {
                projectsGrid.innerHTML = `
                    <div class="no-projects">
                        <p>Este operador aún no ha publicado proyectos en la red.</p>
                    </div>
                `;
            }
        }
    } else {
        // Handle Not Found
        if (container)
            container.innerHTML =
                "<h1 style='text-align:center; margin-top:5rem; color:red;'>OPERADOR NO ENCONTRADO</h1>";
    }
</script>

<style>
    .profile-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 8rem 2rem 4rem;
        min-height: 100vh;
    }

    .profile-header {
        display: flex;
        gap: 4rem;
        margin-bottom: 6rem;
        align-items: center;
    }

    .profile-image-container {
        flex-shrink: 0;
        width: 300px;
        height: 300px;
        position: relative;
    }

    .profile-image-container img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 20px;
        border: 2px solid var(--neon-green);
        box-shadow: 0 0 30px rgba(57, 255, 20, 0.2);
    }

    .profile-image-container::before {
        content: "";
        position: absolute;
        inset: -10px;
        border: 1px solid var(--cyber-purple);
        border-radius: 24px;
        z-index: -1;
    }

    .profile-info h1 {
        font-size: 3.5rem;
        color: var(--text-main);
        margin-bottom: 0.5rem;
        letter-spacing: 2px;
    }

    .profile-info h3 {
        color: var(--neon-green);
        font-size: 1.5rem;
        margin-bottom: 1.5rem;
        font-family: var(--font-heading);
    }

    .profile-info p {
        color: var(--text-dim);
        font-size: 1.1rem;
        line-height: 1.8;
        max-width: 600px;
        margin-bottom: 2rem;
    }

    .skills-list {
        display: flex;
        flex-wrap: wrap;
        gap: 0.8rem;
    }

    .skill-tag {
        background: transparent;
        border: 1px solid var(--cyber-purple);
        color: var(--cyber-purple);
        padding: 0.5rem 1rem;
        border-radius: 50px;
        font-size: 0.9rem;
    }

    .section-title {
        text-align: center;
        font-size: 2.5rem;
        margin-bottom: 3rem;
        color: var(--text-main);
    }

    .projects-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 2rem;
    }

    .project-card {
        background: rgb(5, 10, 8);
        border: 1px solid var(--glass-border);
        border-radius: 12px;
        overflow: hidden;
        transition: transform 0.3s;
    }

    .project-card:hover {
        transform: translateY(-5px);
        border-color: var(--neon-green);
    }

    .project-img {
        height: 200px;
        background-size: cover;
        background-position: center;
        border-bottom: 1px solid var(--glass-border);
    }

    .project-content {
        padding: 1.5rem;
    }

    .project-top {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 1rem;
    }

    .project-top h3 {
        font-size: 1.4rem;
        color: var(--text-main);
        margin: 0;
    }

    .type-badge {
        font-size: 0.7rem;
        padding: 0.2rem 0.6rem;
        border-radius: 4px;
        text-transform: uppercase;
    }

    .type-badge.pro {
        background: rgba(57, 255, 20, 0.15);
        color: var(--neon-green);
    }

    .type-badge.acad {
        background: rgba(188, 19, 254, 0.15);
        color: var(--cyber-purple);
    }

    .project-content p {
        color: var(--text-dim);
        font-size: 0.95rem;
        margin-bottom: 1.5rem;
        line-height: 1.5;
    }

    .tech-stack {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 1.5rem;
    }

    .tech-stack span {
        font-size: 0.8rem;
        color: #aaa;
        background: #111;
        padding: 0.2rem 0.5rem;
        border-radius: 4px;
    }

    .project-links {
        display: flex;
        gap: 1rem;
    }

    .cyber-btn {
        flex: 1;
        text-align: center;
        padding: 0.6rem;
        border: 1px solid var(--glass-border);
        color: var(--text-main);
        text-decoration: none;
        font-size: 0.9rem;
        transition: all 0.3s;
    }

    .cyber-btn:hover {
        border-color: var(--text-main);
        background: rgba(255, 255, 255, 0.05);
    }

    .cyber-btn.fill {
        background: var(--neon-green);
        border-color: var(--neon-green);
        color: #000;
        font-weight: bold;
    }

    .cyber-btn.fill:hover {
        background: transparent;
        color: var(--neon-green);
    }

    .no-projects {
        text-align: center;
        grid-column: 1 / -1;
        padding: 3rem;
        border: 1px dashed var(--glass-border);
        color: var(--text-dim);
    }

    @media (max-width: 768px) {
        .profile-header {
            flex-direction: column;
            text-align: center;
            gap: 2rem;
        }

        .profile-info h1 {
            font-size: 2.5rem;
        }

        .skills-list {
            justify-content: center;
        }
    }
</style>
