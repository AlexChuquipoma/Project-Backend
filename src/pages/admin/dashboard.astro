---
import Layout from "../../layouts/Layout.astro";
---

<Layout
    title="Panel de Administraci√≥n | CiberPortfolio"
    description="Administra usuarios, horarios y reportes de la plataforma CiberPortfolio."
    noindex={true}
>
    <div class="dashboard-container">
        <header class="dashboard-header">
            <h1 class="glitch" data-text="PANEL DE ADMINISTRACI√ìN">
                PANEL DE ADMINISTRACI√ìN
            </h1>
            <p class="subtitle">CONTROL TOTAL DEL SISTEMA</p>
        </header>

        <div class="dashboard-tabs">
            <button class="tab-btn active" data-tab="users">USUARIOS</button>
            <button class="tab-btn" data-tab="schedules">HORARIOS</button>
            <button class="tab-btn" data-tab="reports">REPORTES</button>
        </div>

        <div class="dashboard-content">
            <!-- Users View -->
            <div id="users-view" class="view-section active">
                <div class="view-header">
                    <h2>GESTI√ìN DE USUARIOS</h2>
                    <input
                        type="text"
                        id="user-search"
                        placeholder="Buscar usuario..."
                        class="cyber-input"
                    />
                </div>
                <div class="table-container">
                    <table class="cyber-table">
                        <thead>
                            <tr>
                                <th>NOMBRE</th>
                                <th>EMAIL</th>
                                <th>ROL</th>
                                <th>ACCIONES</th>
                            </tr>
                        </thead>
                        <tbody id="users-body">
                            <!-- Injected via JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Schedules View -->
            <div id="schedules-view" class="view-section hidden">
                <div class="view-header">
                    <h2>GESTI√ìN DE HORARIOS</h2>
                </div>
                <div class="schedule-grid">
                    <div class="control-panel">
                        <h3>Asignar Disponibilidad</h3>
                        <form id="schedule-form">
                            <div class="input-group">
                                <label>PROGRAMADOR</label>
                                <select
                                    id="prog-select"
                                    name="programmerId"
                                    required
                                >
                                    <option value="" disabled selected
                                        >Seleccionar...</option
                                    >
                                    <!-- Injected -->
                                </select>
                            </div>
                            <div class="input-group">
                                <label>FECHA</label>
                                <input type="date" name="date" required />
                            </div>
                            <div class="input-group">
                                <label>HORA</label>
                                <input type="time" name="time" required />
                            </div>
                            <div class="input-group">
                                <label>MODALIDAD</label>
                                <select name="modality" required>
                                    <option value="VIRTUAL">Virtual</option>
                                    <option value="PRESENCIAL">Presencial</option>
                                </select>
                            </div>
                            <button type="submit" class="cyber-button"
                                >AGREGAR HORARIO</button
                            >
                        </form>
                    </div>
                    <div class="list-panel">
                        <h3>Horarios Activos</h3>
                        <ul id="schedule-list" class="cyber-list">
                            <!-- Injected -->
                        </ul>
                    </div>
                </div>
            </div>


            <!-- Reports View -->
            <div id="reports-view" class="view-section hidden">
                <div class="view-header">
                    <h2>REPORTES ADMINISTRATIVOS</h2>
                </div>
                
                <div class="reports-grid">
                    <!-- Global Advisories Report -->
                    <div class="report-card">
                        <div class="report-header">
                            <h3>üìä Reporte Global de Asesor√≠as</h3>
                            <div class="export-actions">
                                <button class="export-btn pdf" onclick="window.exportAdvisoriesPDF()">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                                    PDF
                                </button>
                                <button class="export-btn excel" onclick="window.exportAdvisoriesExcel()">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="9" y1="3" x2="9" y2="21"></line><path d="M17 16h-4"></path><path d="M17 12h-4"></path><path d="M17 8h-4"></path></svg>
                                    Excel
                                </button>
                            </div>
                        </div>
                        <div class="report-preview table-container">
                            <table class="cyber-table">
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Programador</th>
                                        <th>Usuario</th>
                                        <th>Estado</th>
                                    </tr>
                                </thead>
                                <tbody id="report-advisories-body">
                                    <tr><td colspan="4" class="text-center">Cargando datos...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Projects Report -->
                    <div class="report-card">
                        <div class="report-header">
                            <h3>üöÄ Reporte de Proyectos</h3>
                            <div class="export-actions">
                                <button class="export-btn pdf" onclick="window.exportProjectsPDF()">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                                    PDF
                                </button>
                                <button class="export-btn excel" onclick="window.exportProjectsExcel()">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="9" y1="3" x2="9" y2="21"></line><path d="M17 16h-4"></path><path d="M17 12h-4"></path><path d="M17 8h-4"></path></svg>
                                    Excel
                                </button>
                            </div>
                        </div>
                        <div class="report-preview table-container">
                            <table class="cyber-table">
                                <thead>
                                    <tr>
                                        <th>Proyecto</th>
                                        <th>Due√±o</th>
                                        <th>Tipo</th>
                                        <th>Tecnolog√≠as</th>
                                    </tr>
                                </thead>
                                <tbody id="report-projects-body">
                                    <tr><td colspan="4" class="text-center">Cargando datos...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

<script>
    import {
        updateUserRole,
        deleteUser,
        getAllAdvisories,
        getAllUsers
    } from "../../lib/services/adminService";
    import {
        getAllSchedules,
        createSchedule,
        deleteSchedule,
    } from "../../lib/services/scheduleService";

    // Auth Check
    const userStr = localStorage.getItem("ciber_user");
    if (!userStr) {
        window.location.href = "/auth/login";
    } else {
        const user = JSON.parse(userStr);
        if (user.role !== "admin") {
            window.location.href = "/";
        }
    }

    // Tabs Logic
    const tabs = document.querySelectorAll(".tab-btn");
    const views = document.querySelectorAll(".view-section");

    tabs.forEach((tab) => {
        tab.addEventListener("click", () => {
            tabs.forEach((t) => t.classList.remove("active"));
            views.forEach((v) => v.classList.add("hidden"));
            views.forEach((v) => v.classList.remove("active"));

            tab.classList.add("active");
            const viewId = (tab as HTMLElement).dataset.tab + "-view";
            const view = document.getElementById(viewId);
            if (view) {
                view.classList.remove("hidden");
                view.classList.add("active");
            }
        });
    });

    // --- USERS MANAGEMENT ---
    const usersBody = document.getElementById("users-body");
    const userSearch = document.getElementById("user-search");

    async function loadUsers() {
        try {
            // Fetch from API
            const users = await getAllUsers();

            // Sync with localStorage for other tabs compatibility
            localStorage.setItem("ciber_user_db", JSON.stringify(users));

            renderUsersTable(users);
            loadProgrammerOptions(); // Refresh programmer list
        } catch (error) {
            console.error(error);
            alert("Error al cargar usuarios");
        }
    }

    function renderUsersTable(users: any[]) {
        const searchTerm = (userSearch as HTMLInputElement).value.toLowerCase();

        const filteredUsers = users.filter(
            (u: any) =>
                u.name.toLowerCase().includes(searchTerm) ||
                u.email.toLowerCase().includes(searchTerm),
        );

        if (usersBody) {
            usersBody.innerHTML = filteredUsers
                .map(
                    (u: any) => `
                <tr>
                    <td>
                        <div class="user-cell">
                            <span class="user-name">${u.name}</span>
                        </div>
                    </td>
                    <td>${u.email}</td>
                    <td>
                        <select onchange="window.updateUserRole('${
                            u.id
                        }', this.value)" class="role-select-global ${u.role ? u.role.toLowerCase() : "user"}">
                            <option value="user" ${
                                u.role?.toLowerCase() === "user"
                                    ? "selected"
                                    : ""
                            }>Usuario</option>
                            <option value="programmer" ${
                                u.role?.toLowerCase() === "programmer"
                                    ? "selected"
                                    : ""
                            }>Programador</option>
                            <option value="admin" ${
                                u.role?.toLowerCase() === "admin"
                                    ? "selected"
                                    : ""
                            }>Admin</option>
                        </select>
                    </td>
                    <td>
                        <button class="action-btn-global delete" onclick="window.deleteUser('${
                            u.id
                        }')">ELIMINAR</button>
                    </td>
                </tr>
            `,
                )
                .join("");
        }
    }

    if (userSearch)
        userSearch.addEventListener("input", () => {
            const users = JSON.parse(
                localStorage.getItem("ciber_user_db") || "[]",
            );
            renderUsersTable(users);
        });

    (window as any).updateUserRole = async (id: string, newRole: string) => {
        if (
            !confirm(
                `¬øEst√°s seguro de cambiar el rol de este usuario a '${newRole.toUpperCase()}'?`,
            )
        ) {
            loadUsers(); // Revert visual change
            return;
        }

        try {
            await updateUserRole(id, newRole);

            // Update current user session if it's me
            const currentUser = JSON.parse(
                localStorage.getItem("ciber_user") || "{}",
            );
            // Assuming ID is string in local but backend uses Long.
            // API response uses string usually if mapped from Long in types?
            // UserDTO uses Long. JSON converts to number.
            // Frontend generic ID usage might be mixed. toString() ensures comparison.
            if (currentUser.id == id) {
                currentUser.role = newRole;
                localStorage.setItem("ciber_user", JSON.stringify(currentUser));
                if (newRole !== "admin") location.reload();
            }

            loadUsers(); // Reload table
        } catch (error) {
            console.error(error);
            alert("Error al actualizar rol");
        }
    };

    (window as any).deleteUser = async (id: string) => {
        if (
            confirm(
                "‚ö† ADVERTENCIA ‚ö†\n\n¬øEst√°s seguro de ELIMINAR a este usuario permanentemente?\nEsta acci√≥n no se puede deshacer.",
            )
        ) {
            try {
                await deleteUser(id);
                loadUsers();
            } catch (error) {
                console.error(error);
                alert("Error al eliminar usuario");
            }
        }
    };

    // --- SCHEDULE MANAGEMENT ---
    const scheduleForm = document.getElementById("schedule-form");
    const progSelect = document.getElementById("prog-select");
    const scheduleList = document.getElementById("schedule-list");

    async function loadProgrammerOptions() {
        const users = JSON.parse(localStorage.getItem("ciber_user_db") || "[]");
        const programmers = users.filter(
            (u: any) => u.role?.toLowerCase() === "programmer",
        );

        if (progSelect) {
            progSelect.innerHTML =
                '<option value="" disabled selected>Seleccionar Programador...</option>' +
                programmers
                    .map(
                        (p: any) =>
                            `<option value="${p.id}">${p.name}</option>`,
                    )
                    .join("");
        }
    }

    async function loadSchedules() {
        try {
            const schedules = await getAllSchedules();

            if (scheduleList) {
                if (schedules.length === 0) {
                    scheduleList.innerHTML =
                        '<li class="empty-state">No hay horarios activos configurados.</li>';
                    return;
                }

                scheduleList.innerHTML = schedules
                    .map((s: any) => {
                        return `
                        <li class="schedule-item">
                            <div class="schedule-info">
                                <span class="prog-name">${s.programmerName || "Desconocido"}</span>
                                <span class="schedule-date">${s.date} <span class="time-badge">${s.time}</span></span>
                            </div>
                            <button class="delete-btn" onclick="window.deleteSchedule('${s.id}')">
                                üóëÔ∏è
                            </button>
                        </li>
                    `;
                    })
                    .join("");
            }
        } catch (error) {
            console.error("Error loading schedules:", error);
            if (scheduleList)
                scheduleList.innerHTML =
                    '<li class="empty-state error">Error al cargar horarios.</li>';
        }
    }

    if (scheduleForm) {
        scheduleForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            const formData = new FormData(scheduleForm as HTMLFormElement);

            if (!formData.get("programmerId")) {
                alert("Debes seleccionar un programador.");
                return;
            }

            try {
                await createSchedule({
                    programmerId: Number(formData.get("programmerId")),
                    date: formData.get("date") as string,
                    time: formData.get("time") as string,
                    modality: formData.get("modality") as "VIRTUAL" | "PRESENCIAL",
                });
                loadSchedules();
                (scheduleForm as HTMLFormElement).reset();
            } catch (error) {
                console.error(error);
                alert("Error al crear horario");
            }
        });
    }

    (window as any).deleteSchedule = async (id: string) => {
        if (!confirm("¬øEliminar este horario?")) return;
        try {
            await deleteSchedule(Number(id));
            loadSchedules();
        } catch (error) {
            console.error(error);
            alert("Error al eliminar horario");
        }
    };

    // --- ADVISORIES VIEW ---


    function getStatusLabel(status: string) {
        switch (status) {
            case "pending":
                return "‚è≥ Pendiente";
            case "accepted":
                return "‚úÖ Aprobada";
            case "rejected":
                return "‚ùå Rechazada";
            default:
                return status;
        }
    }

    // INITIALIZATION
    loadUsers();
    loadProgrammerOptions();
    loadSchedules();

    // --- REPORTS LOGIC ---
    const reportAdvisoriesBody = document.getElementById("report-advisories-body");
    const reportProjectsBody = document.getElementById("report-projects-body");
    let globalAdvisoriesCache: any[] = [];
    let globalProjectsCache: any[] = [];

    async function loadReportsData() {
        try {
            // Load Advisories
            globalAdvisoriesCache = await getAllAdvisories();
            renderAdvisoriesReport(globalAdvisoriesCache);

            // Load Projects
            const { getAllProjects } = await import("../../lib/services/projectService");
            globalProjectsCache = await getAllProjects();
            renderProjectsReport(globalProjectsCache);

        } catch (error) {
            console.error("Error loading reports:", error);
        }
    }

    function renderAdvisoriesReport(data: any[]) {
        if (!reportAdvisoriesBody) return;
        if (data.length === 0) {
            reportAdvisoriesBody.innerHTML = '<tr><td colspan="4" class="text-center">No hay datos.</td></tr>';
            return;
        }
        // Show max 10 latest for preview
        const preview = data.slice(0, 10);
        reportAdvisoriesBody.innerHTML = preview.map((item: any) => `
            <tr>
                <td>${item.date}</td>
                <td>${item.programmerName || "-"}</td>
                <td>${item.userName || "-"}</td>
                <td><span class="status-badge ${item.status}">${getStatusLabel(item.status)}</span></td>
            </tr>
        `).join("") + (data.length > 10 ? `<tr><td colspan="4" class="text-center text-dim">...y ${data.length - 10} m√°s (Ver Export)</td></tr>` : "");
    }

    function renderProjectsReport(data: any[]) {
        if (!reportProjectsBody) return;
        if (data.length === 0) {
            reportProjectsBody.innerHTML = '<tr><td colspan="4" class="text-center">No hay datos.</td></tr>';
            return;
        }
        // Show max 10 latest for preview
        const preview = data.slice(0, 10);
        reportProjectsBody.innerHTML = preview.map((item: any) => `
            <tr>
                <td>${item.name}</td>
                <td>${item.ownerName || "Usuario"}</td>
                <td>${item.type}</td>
                <td><small>${item.techs ? item.techs.join(", ") : "-"}</small></td>
            </tr>
        `).join("") + (data.length > 10 ? `<tr><td colspan="4" class="text-center text-dim">...y ${data.length - 10} m√°s (Ver Export)</td></tr>` : "");
    }

    // EXPORT FUNCTIONS
    (window as any).exportAdvisoriesPDF = async () => {
        const { jsPDF } = await import("jspdf");
        const autoTableModule = await import("jspdf-autotable");
        const autoTable = autoTableModule.default;
        const doc = new jsPDF();
        
        doc.setFontSize(18);
        doc.text("Reporte Global de Asesor√≠as", 14, 20);
        doc.setFontSize(10);
        doc.text(`Generado: ${new Date().toLocaleString()}`, 14, 30);

        const tableData = globalAdvisoriesCache.map((a: any) => [
            a.date,
            a.time,
            a.programmerName || "-",
            a.userName || "-",
            a.modality,
            a.status
        ]);

        autoTable(doc, {
            startY: 40,
            head: [['Fecha', 'Hora', 'Programador', 'Usuario', 'Modalidad', 'Estado']],
            body: tableData,
        });

        doc.save("reporte_asesorias_global.pdf");
    };

    (window as any).exportAdvisoriesExcel = async () => {
        const XLSX = await import("xlsx");
        const data = globalAdvisoriesCache.map((a: any) => ({
            "Fecha": a.date,
            "Hora": a.time,
            "Programador": a.programmerName,
            "Usuario": a.userName,
            "Email Usuario": a.userEmail || "-", // Ensure DTO has this or check
            "Asunto": a.message, // Initial message
            "Modalidad": a.modality,
            "Estado": a.status,
            "Respuesta": a.responseMessage || "-"
        }));

        const ws = XLSX.utils.json_to_sheet(data);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Asesor√≠as Globales");
        XLSX.writeFile(wb, "reporte_asesorias_global.xlsx");
    };

    (window as any).exportProjectsPDF = async () => {
        const { jsPDF } = await import("jspdf");
        const autoTableModule = await import("jspdf-autotable");
        const autoTable = autoTableModule.default;
        const doc = new jsPDF();
        
        doc.setFontSize(18);
        doc.text("Reporte Global de Proyectos", 14, 20);
        
        const tableData = globalProjectsCache.map((p: any) => [
            p.name,
            p.type,
            p.ownerName || "-",
            p.techs ? p.techs.join(", ") : "-",
            p.deployUrl || "-"
        ]);

        autoTable(doc, {
            startY: 40,
            head: [['Proyecto', 'Tipo', 'Due√±o', 'Tecnolog√≠as', 'URL']],
            body: tableData,
        });

        doc.save("reporte_proyectos_global.pdf");
    };

    (window as any).exportProjectsExcel = async () => {
        const XLSX = await import("xlsx");
        const data = globalProjectsCache.map((p: any) => ({
            "ID": p.id,
            "Nombre": p.name,
            "Descripci√≥n": p.description,
            "Tipo": p.type,
            "Due√±o": p.ownerName || "-",
            "Tecnolog√≠as": p.techs ? p.techs.join(", ") : "-",
            "Repositorio": p.repoUrl || "-",
            "Deploy": p.deployUrl || "-"
        }));

        const ws = XLSX.utils.json_to_sheet(data);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Proyectos Globales");
        XLSX.writeFile(wb, "reporte_proyectos_global.xlsx");
    };

    // Load reports when tab is clicked
    tabs.forEach((t) => {
        if ((t as HTMLElement).dataset.tab === "reports") {
            t.addEventListener("click", () => {
                if (globalAdvisoriesCache.length === 0) loadReportsData();
            });
        }
    });

</script>

<style>
    .dashboard-container {
        padding: 6rem 2rem 2rem;
        max-width: 1400px;
        margin: 0 auto;
        min-height: 100vh;
    }

    .dashboard-header {
        text-align: center;
        margin-bottom: 4rem;
        position: relative;
    }

    .dashboard-header h1 {
        font-size: 3.5rem;
        color: var(--text-main);
        letter-spacing: 6px;
        margin-bottom: 0.5rem;
        text-shadow: 0 0 20px rgba(188, 19, 254, 0.4);
    }

    .subtitle {
        color: var(--neon-green);
        letter-spacing: 3px;
        font-size: 1.1rem;
        text-transform: uppercase;
        opacity: 0.8;
    }

    /* TABS */
    .dashboard-tabs {
        display: flex;
        justify-content: center;
        gap: 1.5rem;
        margin-bottom: 3rem;
    }

    .tab-btn {
        background: rgba(10, 15, 12, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: var(--text-dim);
        padding: 1rem 2.5rem;
        font-family: var(--font-heading);
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        font-size: 1rem;
        letter-spacing: 2px;
        position: relative;
        overflow: hidden;
    }

    .tab-btn::before {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 2px;
        background: var(--cyber-purple);
        transform: scaleX(0);
        transition: transform 0.3s;
        transform-origin: right;
    }

    .tab-btn:hover {
        color: white;
        border-color: rgba(188, 19, 254, 0.5);
    }

    .tab-btn.active {
        color: var(--cyber-purple);
        background: rgba(188, 19, 254, 0.05);
        border-color: var(--cyber-purple);
        box-shadow: 0 0 20px rgba(188, 19, 254, 0.15);
    }

    .tab-btn.active::before {
        transform: scaleX(1);
        transform-origin: left;
    }

    /* SECTIONS */
    .view-section {
        background: rgba(5, 8, 10, 0.6);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(188, 19, 254, 0.2); /* Purple border for Admin */
        padding: 3rem;
        border-radius: 16px;
        min-height: 500px;
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        animation: fadeIn 0.4s ease-out;
    }

    .view-section.hidden {
        display: none;
    }

    .view-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2.5rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        padding-bottom: 1.5rem;
    }

    .view-header h2 {
        color: var(--text-main);
        margin: 0;
        font-size: 1.8rem;
        letter-spacing: 1px;
    }

    /* INPUTS */
    .cyber-input,
    .cyber-select,
    .input-group input,
    .input-group select {
        background: rgba(0, 0, 0, 0.4);
        border: 1px solid rgba(255, 255, 255, 0.15);
        color: white;
        padding: 0.8rem 1.2rem;
        border-radius: 6px;
        font-family: inherit;
        transition: all 0.3s;
        min-width: 250px;
    }

    .cyber-input:focus,
    .input-group input:focus,
    .input-group select:focus {
        outline: none;
        border-color: var(--neon-green);
        box-shadow: 0 0 10px rgba(57, 255, 20, 0.1);
    }

    /* TABLES */
    .table-container {
        overflow-x: auto;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 8px;
    }

    .cyber-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        color: var(--text-dim);
    }

    .cyber-table th {
        background: rgba(188, 19, 254, 0.1);
        color: var(--neon-green);
        text-transform: uppercase;
        padding: 1.2rem 1.5rem;
        font-size: 0.9rem;
        letter-spacing: 1px;
        border-bottom: 2px solid rgba(188, 19, 254, 0.3);
        text-align: left;
    }

    .cyber-table td {
        padding: 1.2rem 1.5rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.03);
        vertical-align: middle;
        transition: background 0.2s;
    }

    .cyber-table tr:hover td {
        background: rgba(255, 255, 255, 0.02);
        color: white;
    }

    .cyber-button {
        background: linear-gradient(45deg, var(--cyber-purple), #9d00e0);
        color: white;
        border: none;
        padding: 1rem 2rem;
        width: 100%;
        font-weight: bold;
        cursor: pointer;
        text-transform: uppercase;
        letter-spacing: 1px;
        transition: all 0.3s;
        border-radius: 4px;
        position: relative;
        overflow: hidden;
    }

    .cyber-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(188, 19, 254, 0.4);
    }

    /* SCHEDULE LAYOUT */
    .schedule-grid {
        display: grid;
        grid-template-columns: 350px 1fr;
        gap: 2rem;
        align-items: start;
    }

    .control-panel {
        background: rgba(0, 0, 0, 0.3);
        padding: 2rem;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .control-panel h3,
    .list-panel h3 {
        margin-top: 0;
        margin-bottom: 1.5rem;
        color: var(--text-main);
        font-size: 1.2rem;
        border-left: 3px solid var(--neon-green);
        padding-left: 1rem;
    }

    .list-panel {
        background: rgba(0, 0, 0, 0.3);
        padding: 2rem;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        max-height: 600px;
        overflow-y: auto;
    }

    .cyber-list {
        padding: 0;
        margin: 0;
        list-style: none;
    }

    .schedule-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: rgba(255, 255, 255, 0.02);
        padding: 1rem 1.5rem;
        border-radius: 8px;
        margin-bottom: 0.8rem;
        transition: all 0.2s;
        border: 1px solid transparent;
    }

    .schedule-item:hover {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(99, 242, 255, 0.2);
    }

    .schedule-info {
        display: flex;
        flex-direction: column;
        gap: 0.3rem;
    }

    .prog-name {
        color: white;
        font-weight: bold;
        font-size: 1.1rem;
    }

    .schedule-date {
        color: var(--text-dim);
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .time-badge {
        background: rgba(99, 242, 255, 0.1);
        color: #63f2ff;
        padding: 0.2rem 0.5rem;
        border-radius: 4px;
        font-size: 0.8rem;
    }

    .delete-btn {
        opacity: 0.5;
        transition: opacity 0.2s;
        background: none;
        border: none;
        font-size: 1.2rem;
        cursor: pointer;
    }

    .delete-btn:hover {
        opacity: 1;
        transform: scale(1.1);
    }

    /* STATUS BADGES */
    .status-badge {
        display: inline-block;
        padding: 0.4rem 0.8rem;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: bold;
        text-transform: uppercase;
    }

    .status-badge.pending {
        background: rgba(255, 165, 0, 0.15);
        color: orange;
        border: 1px solid rgba(255, 165, 0, 0.3);
    }

    .status-badge.accepted {
        background: rgba(57, 255, 20, 0.15);
        color: var(--neon-green);
        border: 1px solid rgba(57, 255, 20, 0.3);
    }

    .status-badge.rejected {
        background: rgba(255, 50, 50, 0.15);
        color: #ff4d4d;
        border: 1px solid rgba(255, 50, 50, 0.3);
    }

    .user-info-sm {
        display: flex;
        flex-direction: column;
    }
    .u-name {
        color: white;
        font-weight: 500;
    }
    .u-email {
        font-size: 0.85rem;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* REPORTS STYLES */
    .reports-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 2rem;
    }

    .report-card {
        background: rgba(0,0,0,0.3);
        border: 1px solid rgba(255,255,255,0.1);
        border-radius: 12px;
        padding: 1.5rem;
    }

    .report-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        border-bottom: 1px solid rgba(255,255,255,0.05);
        padding-bottom: 1rem;
    }

    .report-header h3 {
        color: var(--text-main);
        font-size: 1.3rem;
        margin: 0;
    }

    .export-actions {
        display: flex;
        gap: 0.5rem;
    }

    .export-btn {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s;
        font-size: 0.9rem;
    }

    .export-btn.pdf {
        background: rgba(255, 68, 68, 0.1);
        color: #ff4444;
        border: 1px solid #ff4444;
    }

    .export-btn.pdf:hover {
        background: #ff4444;
        color: white;
    }

    .export-btn.excel {
        background: rgba(57, 255, 20, 0.1);
        color: #39ff14;
        border: 1px solid #39ff14;
    }

    .export-btn.excel:hover {
        background: #39ff14;
        color: black;
    }

    .text-center { text-align: center; }
    .text-dim { color: var(--text-dim); }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @media (max-width: 768px) {
        .dashboard-container {
            padding: 6rem 1rem 1rem;
        }

        .dashboard-header h1 {
            font-size: 2rem;
            letter-spacing: 2px;
        }

        .dashboard-tabs {
            flex-direction: column;
            gap: 1rem;
        }

        .tab-btn {
            width: 100%;
            padding: 1rem;
        }

        .view-section {
            padding: 1.5rem;
        }

        .schedule-grid {
            grid-template-columns: 1fr;
        }

        .control-panel,
        .list-panel {
            padding: 1rem;
        }

        .view-header {
            flex-direction: column;
            gap: 1rem;
            align-items: flex-start;
        }

        .view-header h2 {
            font-size: 1.5rem;
        }

        .cyber-input {
            width: 100%;
        }

        .table-container {
            margin: 0 -1rem; /* Negative margin to span full width */
            border-radius: 0;
            padding: 0 1rem; /* Padding for scroll content */
        }

        .cyber-table th,
        .cyber-table td {
            white-space: nowrap; /* Force horizontal scroll */
            padding: 1rem;
            font-size: 0.85rem;
        }
    }
</style>

<style is:global>
    /* DYNAMIC CONTENT STYLES (Admin Dashboard) */

    /* ROLE SELECT */
    .role-select-global {
        appearance: none;
        -webkit-appearance: none;
        background-color: rgba(5, 10, 8, 0.8) !important;
        border: 1px solid rgba(255, 255, 255, 0.1) !important;
        color: white !important;
        padding: 0.6rem 2rem 0.6rem 1rem !important; /* Reduced padding-right */
        border-radius: 4px;
        cursor: pointer;
        font-family: inherit;
        font-size: 0.85rem;
        transition: all 0.3s;
        min-width: 140px;
        text-align: left;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='white' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 0.8rem center;
    }

    .role-select-global option {
        background-color: #050a08;
        color: white;
    }

    .role-select-global:hover {
        background-color: rgba(255, 255, 255, 0.05) !important;
        border-color: #bc13fe !important;
    }

    .role-select-global:focus {
        outline: none;
        box-shadow: 0 0 10px rgba(188, 19, 254, 0.3);
    }

    .role-select-global.admin {
        border-color: #bc13fe !important;
        color: #bc13fe !important;
        font-weight: bold;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23bc13fe' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
    }
    .role-select-global.programmer {
        border-color: #39ff14 !important;
        color: #39ff14 !important;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%2339ff14' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
    }

    /* ACTION BUTTONS */
    .action-btn-global {
        background: rgba(255, 50, 50, 0.05);
        border: 1px solid rgba(255, 50, 50, 0.3);
        color: #ff4d4d;
        padding: 0.6rem 1.5rem;
        cursor: pointer;
        font-size: 0.75rem;
        transition: all 0.3s;
        border-radius: 4px;
        text-transform: uppercase;
        letter-spacing: 2px;
        font-weight: bold;
        position: relative;
        overflow: hidden;
    }

    .action-btn-global::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
            90deg,
            transparent,
            rgba(255, 50, 50, 0.2),
            transparent
        );
        transition: 0.5s;
    }

    .action-btn-global:hover::before {
        left: 100%;
    }

    .action-btn-global:hover {
        background: rgba(255, 50, 50, 0.15);
        color: #ff8080;
        border-color: #ff4d4d;
        box-shadow: 0 0 20px rgba(255, 0, 0, 0.3);
        text-shadow: 0 0 8px rgba(255, 0, 0, 0.6);
        transform: translateY(-2px);
    }
</style>
