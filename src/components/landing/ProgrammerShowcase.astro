---
import ProgrammerCard from "./ProgrammerCard.astro";
import { getAllProfiles } from "../../lib/services/profileService";

// Fetch real programmer profiles from backend
let programmers: any[] = [];
try {
    const profiles = await getAllProfiles();

    // Transform backend profiles to match ProgrammerCard format
    programmers = profiles.map((profile) => ({
        id: profile.userId.toString(),
        name: profile.userName,
        role: profile.jobTitle || "Developer",
        image:
            profile.imageUrl ||
            `https://ui-avatars.com/api/?name=${encodeURIComponent(profile.userName)}&size=400&background=random`,
        skills: profile.skills?.slice(0, 3) || [], // Show first 3 skills
        socials: {
            github: profile.githubUrl || undefined,
            linkedin: profile.linkedinUrl || undefined,
            instagram: profile.instagramUrl || undefined,
        },
    }));
} catch (error) {
    console.error("Failed to load programmer profiles:", error);
    // Fallback to empty array if API fails
    programmers = [];
}
---

<section id="programmers" class="programmers-section section-padding">
    <div class="container">
        <h2 class="section-title">
            NUESTROS <span class="neon-text-purple">OPERADORES</span>
        </h2>
        <p class="section-description">
            Cada miembro de nuestro colectivo ha sido forjado en el fuego de
            proyectos de alto impacto. Arquitectos de software, visionarios del
            frontend y estrategas de datos unidos por un propósito: la
            excelencia técnica.
        </p>
        <div class="grid">
            {programmers.map((dev) => <ProgrammerCard {...dev} />)}
        </div>
    </div>
</section>

<style>
    .section-title {
        text-align: center;
        font-size: 3rem;
        margin-bottom: 4rem;
        color: var(--text-main);
    }

    .section-description {
        text-align: center;
        max-width: 800px;
        margin: -3rem auto 4rem;
        color: var(--text-dim);
        font-size: 1.1rem;
        line-height: 1.6;
    }

    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 2rem;
    }

    @media (max-width: 768px) {
        .section-title {
            font-size: 2rem;
            margin-bottom: 2rem;
        }
    }
</style>
